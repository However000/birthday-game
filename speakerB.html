<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Speaker B</title>
<style>
body { font-family: Arial; text-align:center; padding:20px; background:#fafafa; }
#maze { font-family: monospace; font-size:26px; display:inline-block; background:#fff; padding:10px; border:2px solid #333; line-height:30px;}
.btn { padding:10px 20px; font-size:18px; background:#007bff; color:white; border:none; border-radius:6px; margin:10px; cursor:pointer; }
#qr-reader { width:300px; margin:20px auto; display:none; }
#scanResult { font-size:20px; margin-top:20px; white-space:pre-line; }
.hint-card { width:200px; height:200px; border:2px solid #333; margin:10px auto; background:#fff; padding:10px; cursor:pointer; font-family:monospace; white-space:pre; font-size:20px; display:none; }
</style>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
<h1>ğŸ”Š Speaker Bï¼šè¿·å®®</h1>
<p>åœ¨è¿·å®®æ‰¾åˆ°å¯¶ç®±è§£é–æ•¸å­—ï¼Œæ‹¼å‡º GUNDAM</p>
<pre id="maze"></pre>

<button id="scanBtn" class="btn" style="display:none;" onclick="startScan()">ğŸ“· æƒæä¸‹ä¸€å€‹ QR Code</button>
<div id="qr-reader"></div>
<p id="scanResult"></p>

<div id="hintCard" class="hint-card">
____5_
1_2___ 
_3___ 
__4__
____6
</div>

<script>
// 5x5 è¿·å®®
let mazeMap=[
  "WWWWW",
  "W...W",
  "W.W.W",
  "W...W",
  "WWWWW"
];
let playerX=1, playerY=1;
// å¯¶ç®±ä½ç½®å°æ‡‰æç¤ºåºè™Ÿ
let chests=[
  {x:3,y:1,num:5},
  {x:1,y:1,num:1},
  {x:2,y:1,num:2},
  {x:2,y:2,num:3},
  {x:3,y:3,num:4},
  {x:4,y:3,num:6}
];
let found=[];

function drawMaze(){
  let out="";
  for(let y=0;y<mazeMap.length;y++){
    for(let x=0;x<mazeMap[y].length;x++){
      if(x===playerX && y===playerY) out+="ğŸŸ¦";
      else{
        let cell=mazeMap[y][x];
        if(cell==="W") out+="â¬›";
        else out+="â¬œ";
        chests.forEach(c=>{
          if(c.x===x && c.y===y && !found.includes(c.num)) out+="ğŸ“¦";
        });
      }
    }
    out+="\n";
  }
  document.getElementById("maze").textContent=out;
  scanAround();
  if(found.length===chests.length){
    document.getElementById("hintCard").style.display="block";
    localStorage.setItem('partB_done','true');
    document.getElementById("scanBtn").style.display="inline-block";
    alert("å®Œæˆè¿·å®®ï¼å·²ç²å¾— Part B æç¤ºå¡ï¼");
  }
}

function move(dx,dy){
  let nx=playerX+dx, ny=playerY+dy;
  if(ny<0||ny>=mazeMap.length||nx<0||nx>=mazeMap[0].length) return;
  if(mazeMap[ny][nx]==="W") return;
  playerX=nx; playerY=ny;
  chests.forEach(c=>{
    if(c.x===playerX && c.y===playerY && !found.includes(c.num)){
      found.push(c.num);
      alert("æ‰¾åˆ°å¯¶ç®±ï¼æ•¸å­—: "+c.num);
    }
  });
  drawMaze();
}

function scanAround(){
  let dirs=[{n:"ä¸Š",dx:0,dy:-1},{n:"ä¸‹",dx:0,dy:1},{n:"å·¦",dx:-1,dy:0},{n:"å³",dx:1,dy:0}];
  let res="æƒæå‘¨åœ:\n";
  dirs.forEach(d=>{
    let nx=playerX+d.dx, ny=playerY+d.dy;
    if(ny<0||ny>=mazeMap.length||nx<0||nx>=mazeMap[0].length) res+=d.n+": âŒ\n";
    else res+=d.n+": "+(mazeMap[ny][nx]==="W"?"â¬›":"â¬œ")+"\n";
  });
  document.getElementById("scanResult").textContent=res;
}

// é»æ“Šæç¤ºå¡æ”¾å¤§ç¸®å°
document.getElementById("hintCard").addEventListener('click',()=>{
  const card=document.getElementById("hintCard");
  card.style.transform=(card.style.transform==='scale(1.5)')? 'scale(1)': 'scale(1.5)';
});

// QR Scanner
function startScan(){
  document.getElementById("qr-reader").style.display="block";
  const qrReader = new Html5Qrcode("qr-reader");
  qrReader.start(
    {facingMode:"environment"},
    {fps:10, qrbox:250},
    qrMessage=>{
      qrReader.stop();
      if(qrMessage.includes('speakerA.html')) window.location.href=qrMessage;
      else if(qrMessage.includes('gundam.html')){
        if(localStorage.getItem('partA_done') && localStorage.getItem('partB_done')){
          window.location.href=qrMessage;
        } else alert("è«‹å…ˆå®Œæˆ Part A å’Œ Part B æ‰èƒ½æƒææœ€çµ‚ç­”æ¡ˆï¼");
      }
    }, error=>{}
  );
}

let startX,startY;
document.addEventListener("touchstart",e=>{startX=e.touches[0].clientX; startY=e.touches[0].clientY;});
document.addEventListener("touchend",e=>{
  let dx=e.changedTouches[0].clientX-startX;
  let dy=e.changedTouches[0].clientY-startY;
  if(Math.abs(dx)>Math.abs(dy)){ if(dx>0) move(1,0); else move(-1,0);}
  else{ if(dy>0) move(0,1); else move(0,-1);}
});

drawMaze();
</script>
</body>
</html>
